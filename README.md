# SQL-Server
SQL Serverのサンプルクエリです。  
フォルダ構成は、次のとおりです。  
  
## 消費税関連
1. fn消費税.sql...指定した日付の期間に該当する税抜金額から消費税額を返すストアドファンクションです。消費税率テーブルの構造と作成については、本書をお読みください。
1. fn税抜.sql...指定した日付の期間に該当する消費税率から税抜金額を返すストアドファンクションです。
1. fn税込.sql...指定した日付の期間に該当する消費税率から税込金額を返すストアドファンクションです。

## 日付操作
1. fn_getdate_excepttime.sql...引数に指定された日付型から時刻要素を取り除いて返すストアドファンクションです。
1. fn_getdate_dayofweek.sql...任意の年月の第ｎ回目の〇曜日の日付を求めるストアドファンクションです。
1. fn_getdate_monthstart.sql...月初を返すストアドファンクションです。
1. fn_getdate_monthend.sql...月末を返すストアドファンクションです。

## 祝日を考慮した営業日と定休日の判定
1. fn_getdate_syunbun.sql...引数に指定された年の春分の日を返すストアドファンクションです。
1. fn_getdate_syuubun.sql...引数に指定された年の秋分の日を返すストアドファンクションです。
1. sp_holiday_insert.sql...引数に指定されたテンポラリテーブルに休日をセットするストアドプロシージャです。休日テーブルの構造と作成については、本書をお読みください。
1. sp_holiday_setdata.sql...休日テーブルに指定した年の休日を追加するストアドプロシージャです。休日テーブルの構造と作成については、本書をお読みください。
1. fn最終営業日.sql...任意の年月の最終営業日を求めるストアドファンクションです。

## データが入力されていない日を取得
1. fn_getdigits.sql...数値の開始と終了を指定し、該当する範囲の数列の集合をテーブルとして返すストアドファンクションです。

## ストアドプロシージャ内での例外処理
1. sp_returnerror.sql...エラーの詳細を返すストアドプロシージャです。

## データベースオブジェクト操作
1. sp_get_process.sql...指定したホスト名が生成したSQL Serverのプロセスを取得し、spidを返すストアドプロシージャです。
1. sp_kill_process.sql...指定したspidのプロセスを削除するストアドプロシージャです。

## 高度なテーブル構造変更
1. copy_table_oldver.sql...同一システムのデータベースにおいて、あるデータベースから別のデータベースへすべてのテーブルの内容をコピーします。

## パスワードをデータベースに保存
1. fn_create_hash.sql...引数に指定された文字列を暗号化して返すストアドファンクションです。

## 第三・第四水準漢字の扱い
1. create_table.sql...高水準テーブルを作成します。
1. 文字一覧.sql...高水準テーブルにレコードを追加します。
1. 第3・4水準対応文字一覧.xlsm...高水準テーブルにレコードを追加するINSERTコマンドを生成するエクセルマクロです。

## SQL Serverのサービスが停止している場合の対処
1. RewriteAuth_MSSQLService.vbs...Windows OSのPOWER USERSグループ権限にSQL Serverサービズの実行権限を付与するVBScriptです。
1. basMain.bas...SQL Serverサービスが停止している場合、実行するためのエクセルマクロの標準モジュールです。

## データベース比較クエリ
1. 2つのデータベースに存在するすべてのテーブルを比較し、違いを表示します。

## ログインユーザー生成
1. セキュリティのために、SQL Serverに接続できるユーザーをデータベースごとに生成するときに使います。

